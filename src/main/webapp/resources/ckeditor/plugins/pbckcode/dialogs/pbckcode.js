CKEDITOR.dialog.add("pbckcodeDialog",function(a){var b,d,e,f,c=new PBSyntaxHighlighter(a.settings.highlighter);return{title:a.lang.pbckcode.title,minWidth:600,minHeight:400,contents:[{id:"editor",label:a.lang.pbckcode.editor,elements:[{type:"hbox",children:[{type:"select",id:"code-select",className:"cke_pbckcode_form",label:a.lang.pbckcode.mode,items:a.settings.modes,default:a.settings.modes[0][1],setup:function(a){a&&(a=a.getAscendant("pre",!0),this.setValue(a.getAttribute("data-pbcklang")))},commit:function(a){a&&(a=a.getAscendant("pre",!0),a.setAttribute("data-pbcklang",this.getValue()))},onChange:function(){e.setMode("ace/mode/"+this.getValue())}},{type:"select",id:"code-tabsize-select",className:"cke_pbckcode_form",label:a.lang.pbckcode.tabSize,items:["1","2","4","8"],default:a.settings.tab_size,setup:function(a){a&&(a=a.getAscendant("pre",!0),this.setValue(a.getAttribute("data-pbcktabsize")))},commit:function(a){a&&(a=a.getAscendant("pre",!0),a.setAttribute("data-pbcktabsize",this.getValue()))},onChange:function(a){a&&(f.convertIndentation(e," ",this.getValue()),e.setTabSize(this.getValue()))}}]},{type:"html",html:"<div></div>",id:"code-textarea",className:"cke_pbckcode_ace",style:"position: absolute; top: 80px; left: 10px; right: 10px; bottom: 50px;",setup:function(a){a=a.getHtml(),a=a.replace(RegExp("<br/>","g"),"\n").replace(RegExp("<br>","g"),"\n").replace(RegExp("&lt;","g"),"<").replace(RegExp("&gt;","g"),">").replace(RegExp("&amp;","g"),"&").replace(RegExp("&nbsp;","g")," "),d.setValue(a)},commit:function(a){a.setText(d.getValue())}}]}],onLoad:function(){b=this,d=ace.edit(b.getContentElement("editor","code-textarea").getElement().getId()),a.aceEditor=d,d.setTheme("ace/theme/"+a.settings.theme),d.setHighlightActiveLine(!0),d.setShowInvisibles(!0),e=d.getSession(),e.setMode("ace/mode/"+a.settings.modes[0][1]),e.setTabSize(a.settings.tab_size),e.setUseSoftTabs(!0),f=ace.require("ace/ext/whitespace")},onShow:function(){var b=a.getSelection().getStartElement();b&&(b=b.getAscendant("pre",!0)),b&&"pre"===b.getName()?("pre"!==c.getTag()&&(b=b.getChild(0)),this.insertMode=!1):(b=new CKEDITOR.dom.element("pre"),"pre"!==c.getTag()&&b.append(new CKEDITOR.dom.element("code")),this.insertMode=!0),this.element=b,d.focus(),d.setValue(""),this.insertMode||this.setupContent(this.element)},onOk:function(){var b,d;b=d=this.element,this.insertMode?"pre"!==c.getTag()&&(d=this.element.getChild(0)):b=d.getAscendant("pre",!0),this.commitContent(d),c.setCls(b.getAttribute("data-pbcklang")+" "+a.settings.cls),d.setAttribute("class",c.getCls()),this.insertMode&&a.insertElement(b)}}}),CKEDITOR.dialog.on("resize",function(a){a=a.editor.aceEditor,void 0!==a&&a.resize()});