CKEDITOR.dialog.add("colordialog",function(a){function b(){k.getById(u).removeStyle("background-color"),m.getContentElement("picker","selectedColor").setValue(""),d()}function c(a){a=a.data.getTarget();var b;"td"==a.getName()&&(b=a.getChild(0).getHtml())&&(d(),n=a,n.setAttribute("aria-selected",!0),n.addClass("cke_colordialog_selected"),m.getContentElement("picker","selectedColor").setValue(b))}function d(){n&&(n.removeClass("cke_colordialog_selected"),n.removeAttribute("aria-selected"),n=null)}function e(a){a=a.replace(/^#/,"");for(var b=0,c=[];2>=b;b++)c[b]=parseInt(a.substr(2*b,2),16);return 165<=.2126*c[0]+.7152*c[1]+.0722*c[2]}function f(a){!a.name&&(a=new CKEDITOR.event(a));var d,b=!/mouse/.test(a.name),c=a.data.getTarget();"td"==c.getName()&&(d=c.getChild(0).getHtml())&&(g(a),b?p=c:q=c,b&&c.addClass(e(d)?"cke_colordialog_focused_light":"cke_colordialog_focused_dark"),h(d))}function g(a){(a=!/mouse/.test(a.name)&&p)&&(a.removeClass("cke_colordialog_focused_light"),a.removeClass("cke_colordialog_focused_dark")),p||q||h(!1)}function h(a){a?(k.getById(s).setStyle("background-color",a),k.getById(t).setHtml(a)):(k.getById(s).removeStyle("background-color"),k.getById(t).setHtml("&nbsp;"))}function i(b){var d=b.data,e=d.getTarget(),f=d.getKeystroke(),g="rtl"==a.lang.dir;switch(f){case 38:(b=e.getParent().getPrevious())&&(b=b.getChild([e.getIndex()]),b.focus()),d.preventDefault();break;case 40:(b=e.getParent().getNext())&&(b=b.getChild([e.getIndex()]))&&1==b.type&&b.focus(),d.preventDefault();break;case 32:case 13:c(b),d.preventDefault();break;case g?37:39:(b=e.getNext())?1==b.type&&(b.focus(),d.preventDefault(!0)):(b=e.getParent().getNext())&&(b=b.getChild([0]))&&1==b.type&&(b.focus(),d.preventDefault(!0));break;case g?39:37:(b=e.getPrevious())?(b.focus(),d.preventDefault(!0)):(b=e.getParent().getPrevious())&&(b=b.getLast(),b.focus(),d.preventDefault(!0))}}var m,n,p,q,v,j=CKEDITOR.dom.element,k=CKEDITOR.document,l=a.lang.colordialog,o={type:"html",html:"&nbsp;"},r=function(a){return CKEDITOR.tools.getNextId()+"_"+a},s=r("hicolor"),t=r("hicolortext"),u=r("selhicolor");return function(){function a(a,c){for(var e=a;e<a+3;e++){var f=new j(v.$.insertRow(-1));f.setAttribute("role","row");for(var g=c;g<c+3;g++)for(var h=0;6>h;h++)b(f.$,"#"+d[g]+d[h]+d[e])}}function b(a,b){var d=new j(a.insertCell(-1));d.setAttribute("class","ColorCell cke_colordialog_colorcell"),d.setAttribute("tabIndex",-1),d.setAttribute("role","gridcell"),d.on("keydown",i),d.on("click",c),d.on("focus",f),d.on("blur",g),d.setStyle("background-color",b);var e=r("color_table_cell");d.setAttribute("aria-labelledby",e),d.append(CKEDITOR.dom.element.createFromHtml('<span id="'+e+'" class="cke_voice_label">'+b+"</span>",CKEDITOR.document))}v=CKEDITOR.dom.element.createFromHtml('<table tabIndex="-1" class="cke_colordialog_table" aria-label="'+l.options+'" role="grid" style="border-collapse:separate;" cellspacing="0"><caption class="cke_voice_label">'+l.options+'</caption><tbody role="presentation"></tbody></table>'),v.on("mouseover",f),v.on("mouseout",g);var d="00 33 66 99 cc ff".split(" ");a(0,0),a(3,0),a(0,3),a(3,3);var e=new j(v.$.insertRow(-1));e.setAttribute("role","row"),b(e.$,"#000000");for(var h=0;16>h;h++){var k=h.toString(16);b(e.$,"#"+k+k+k+k+k+k)}b(e.$,"#ffffff")}(),CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(CKEDITOR.plugins.get("colordialog").path+"dialogs/colordialog.css")),{title:l.title,minWidth:360,minHeight:220,onLoad:function(){m=this},onHide:function(){b(),p.removeClass("cke_colordialog_focused_light"),p.removeClass("cke_colordialog_focused_dark"),h(!1),p=null},contents:[{id:"picker",label:l.title,accessKey:"I",elements:[{type:"hbox",padding:0,widths:["70%","10%","30%"],children:[{type:"html",html:"<div></div>",onLoad:function(){CKEDITOR.document.getById(this.domId).append(v)},focus:function(){(p||this.getElement().getElementsByTag("td").getItem(0)).focus()}},o,{type:"vbox",padding:0,widths:["70%","5%","25%"],children:[{type:"html",html:"<span>"+l.highlight+'</span><div id="'+s+'" style="border: 1px solid; height: 74px; width: 74px;"></div><div id="'+t+'">&nbsp;</div><span>'+l.selected+'</span><div id="'+u+'" style="border: 1px solid; height: 20px; width: 74px;"></div>'},{type:"text",label:l.selected,labelStyle:"display:none",id:"selectedColor",style:"width: 76px;margin-top:4px",onChange:function(){try{k.getById(u).setStyle("background-color",this.getValue())}catch(a){b()}}},o,{type:"button",id:"clear",label:l.clear,onClick:b}]}]}]}]}});